require('dotenv').config();
const express = require('express');
const bodyParser = require('body-parser');
const axios = require('axios');
const TelegramBot = require('node-telegram-bot-api');

const { TOKEN, SERVER_URL, PORT } = process.env;
const TELEGRAM_API = `https://api.telegram.org/bot${TOKEN}`;
const URI = `/webhook/${TOKEN}`;
const WEBHOOK_URL = SERVER_URL + URI;

const app = express();
app.use(bodyParser.json());

const bot = new TelegramBot(TOKEN, { polling: true });

const init = async () => {
    const res = await axios.get(`${TELEGRAM_API}/setWebhook?url=${WEBHOOK_URL}`);
    console.log(res.data);
};

app.post(URI, async (req, res) => {
    console.log(req.body);

    const chatId = req.body.message.chat.id;
    const text = req.body.message.text;

    await axios.post(`${TELEGRAM_API}/sendMessage`, {
        chat_id: chatId,
        text: text
    });
    return res.send();
});

app.listen(PORT || 5000, async () => {
    console.log('üöÄ app running on port', PORT || 5000);
    await init();
});

bot.onText(/\/start/, (msg) => {
    bot.sendMessage(msg.chat.id, "–Ø —Ä–∞–¥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –í–∞—Å –≤ –∫–æ–º–∞–Ω–¥–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ –¢–û–û ¬´ANTARES ENGINEERING¬ª! –¢–µ–ø–µ—Ä—å –í—ã —è–≤–ª—è–µ—Ç–µ—Å—å —á–∞—Å—Ç—å—é –≤–µ–¥—É—â–µ–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ù–∞—à–∞ –º–∏—Å—Å–∏—è ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–µ –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–≤–∏—Ç–∏—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π. –ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –∫ –∫–∞—á–µ—Å—Ç–≤—É, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–æ –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ä–æ—Å—Ç –∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ù–∞–∂–º–∏—Ç–µ /help –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.");
});

bot.onText(/\/help/, (msg) => {
    bot.sendMessage(msg.chat.id, `–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ–º–æ–≥—É—Ç –≤–∞–º —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:
    
    /start -> –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    /help -> –ö–æ–º–∞–Ω–¥—ã
    /aboutus -> –û –Ω–∞—Å
    /specialization -> –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    /projects -> –ü—Ä–æ–µ–∫—Ç—ã
    /experience -> –û–ø—ã—Ç
    /contact -> –ö–∞–∫ —Å –Ω–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è`);
});

bot.onText(/\/aboutus/, (msg) => {
    bot.sendMessage(msg.chat.id, '–¢–û–û "ANTARES ENGINEERING" - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –±–æ–ª–µ–µ –¥–µ—Å—è—Ç–∏ –ª–µ—Ç. –ù–∞—à –æ–ø—ã—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω—ã—Ö —Ä–∞–±–æ—Ç –≤—ã–¥–µ–ª—è–µ—Ç –Ω–∞—Å –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤, —Å–ø–æ—Å–æ–±–Ω—ã—Ö –≤–æ–ø–ª–æ—â–∞—Ç—å –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. –ù–∞—à–∏ —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–æ–≤–æ—Ä—è—Ç —Å–∞–º–∏ –∑–∞ —Å–µ–±—è, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞—è –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–µ–∫—Ç—É. –ú—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∏–º, –º—ã —Å–æ–∑–¥–∞–µ–º –Ω–∞–¥–µ–∂–Ω—ã–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∞–º—ã–º –≤—ã—Å–æ–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–∞—á–µ—Å—Ç–≤–∞. –ï—Å–ª–∏ –í—ã –∏—â–µ—Ç–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –¥–ª—è –≤–æ–ø–ª–æ—â–µ–Ω–∏—è –≤–∞—à–∏—Ö —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –Ω–∞–º.');
});

bot.onText(/\/specialization/, (msg) => {
    bot.sendMessage(msg.chat.id, "–°–ü–ï–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò: –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–¥–∞–Ω–∏–π –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–π. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –≤–∏–¥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π. –î–∏—Å—Ç—Ä–∏–±—å—é—Ç–µ—Ä—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–¥–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∏. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ –º–æ–Ω—Ç–∞–∂ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π, —Å–≤—è–∑–∏ –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏. –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ, —Ä–µ–º–æ–Ω—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–º–æ–Ω—Ç–∞–∂–Ω—ã–µ, —Ä–∞–±–æ—Ç—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∏ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –ú–æ–Ω—Ç–∞–∂ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–≥–æ –∏ —Ç–µ–ø–ª–æ—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è. –í–ò–≠ - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞.");
});

bot.onText(/\/projects/, (msg) => {
    bot.sendMessage(msg.chat.id, "–ü–†–û–ï–ö–¢–´: SMART NATIONAL PARK BURABAY - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–µ—Å–Ω—ã—Ö –ø–æ–∂–∞—Ä–æ–≤. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ª–µ—Å–Ω—ã—Ö –ø–æ–∂–∞—Ä–æ–≤ –≤ –ê–ª–º–∞—Ç—ã (–ú–µ–¥–µ–æ, –®—ã–º–±—É–ª–∞–∫, –ë—É—Ç–∞–∫–æ–≤—Å–∫–æ–µ —É—â–µ–ª—å–µ). –ì–õ–ü–† –ï–†–¢I–° –û–†–ú–ê–ù–´ - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ª–µ—Å–Ω—ã—Ö –ø–æ–∂–∞—Ä–æ–≤ (277961–≥–∞)—é. BEELINE - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Å–µ—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ—Ç–æ–≤–æ–π —Å–≤—è–∑–∏. ALTEL TELE2 - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Å–µ—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ—Ç–æ–≤–æ–π —Å–≤—è–∑–∏. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ–º–æ–Ω—Ç –∏ –æ–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —à–∫–æ–ª –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫. –ö–∞–∑–ù–¢–£ –∏–º–µ–Ω–∏ –°–∞—Ç–ø–∞–µ–≤–∞, –º–æ–Ω—Ç–∞–∂ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è (254 –≤–∏–¥–µ–æ–∫–∞–º–µ—Ä—ã).");
});

bot.onText(/\/experience/, (msg) => {
    bot.sendMessage(msg.chat.id, "–ë–æ–ª–µ–µ —á–µ–º 10-–ª–µ—Ç–Ω–∏–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ —Å–∂–∞—Ç—ã–µ —Å—Ä–æ–∫–∏. –ë–æ–ª–µ–µ 200 —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä—è–¥–æ–≤. –ù–∞–º –¥–æ–≤–µ—Ä—è—é—Ç. –ë–æ–ª–µ–µ 150 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –ö –Ω–∞–º –æ–±—Ä–∞—â–∞—é—Ç—Å—è. 8 –Ω–∞–≥—Ä–∞–¥ –∑–∞ —É—Å–ø–µ—à–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ù–∞—Å —Ü–µ–Ω—è—Ç");
});

bot.onText(/\/contact/, (msg) => {
    bot.sendMessage(msg.chat.id, "–í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º: +7 (727) 339 30 87, +7 (747) 505 37 77, +7 (777) 777 07 44, +7 (777) 777 07 44. –ê —Ç–∞–∫ –∂–µ –Ω–∞—à —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: antares.engineering@bk.ru. –ê05–ï3–í1(050012), –†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –≥–æ—Ä–æ–¥ –ê–ª–º–∞—Ç—ã, —É–ª–∏—Ü–∞ –ö–∞—Ä–∞—Å–∞–π –±–∞—Ç—ã—Ä–∞ 1–ê");
});

bot.on('message', (msg) => {
    if (!msg.text.startsWith('/')) {
        bot.sendMessage(msg.chat.id, `–í—ã —Å–∫–∞–∑–∞–ª–∏: ${msg.text}. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã, –Ω–∞—á–∏–Ω–∞—è —Å /`);
    }
});